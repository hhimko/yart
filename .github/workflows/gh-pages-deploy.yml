name: Doxygen GitHub Pages Deploy

# Action for building doxygen docs and deploying to GitHub Pages

on:
    workflow_dispatch:
    pull_request:
    push:
        branches:
          - main

# This allows a subsequently queued workflow run to interrupt previous runs
concurrency:
    group: '${{ github.workflow }} @ ${{ github.ref }}'
    cancel-in-progress: true

permissions:
    contents: write
  
jobs:
    doxygen-build:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout
            uses: actions/checkout@v3

          - name: Install Doxygen
            shell: bash
            run: sudo apt-get install doxygen graphviz -y

          - name: Generate Documentation
            shell: bash
            run: doxygen

    gh-pages-deploy:
        needs: doxygen-build
        permissions:
            pages: write  
        runs-on: ubuntu-latest
        steps:
          - name: Create .nojekyll
            shell: bash
            run: cd yart && touch ./docs/html/.nojekyll

          - name: Deploy to GitHub Pages
            uses: JamesIves/github-pages-deploy-action@v4
            with:
                folder: docs/html
                
